jQuery(document).ready(function() {
  jQuery("#tutorialGnBox").click(function() {
    jQuery("#tutorialGnBox").fadeOut();
  });
  jQuery("#woocommerce_gerencianet_oficial_billet_discount").click(event => handleMask(event));
  jQuery("#woocommerce_gerencianet_oficial_pix_discount").click(event => handleMask(event));

  jQuery("#woocommerce_gerencianet_oficial_pix_number_hours").keypress((e) => onlynumber(e));

  jQuery("#woocommerce_gerencianet_oficial_pix_discount").mask("##0,00%", {reverse: true, onKeyPress: function(percentage){
      if (percentage.length>6) {
        jQuery("#woocommerce_gerencianet_oficial_pix_discount").val("99,99%");
      }
    }});
  jQuery("#woocommerce_gerencianet_oficial_billet_number_days").mask("999");

  jQuery("#showKeysProductionTutorial").click(function() {
    showGnTutorial("keysProduction");
  });

  jQuery("#showKeysDevelopmentTutorial").click(function() {
    showGnTutorial("keysDevelopment");
  });
  jQuery("#showPayeeCodeTutorial").click(function() {
    showGnTutorial("payeeCode");
  });

  jQuery("#woocommerce_gerencianet_oficial_billet_instructions_line_1").attr("maxlength", "90");
  jQuery("#woocommerce_gerencianet_oficial_billet_instructions_line_2").attr("maxlength", "90");
  jQuery("#woocommerce_gerencianet_oficial_billet_instructions_line_3").attr("maxlength", "90");
  jQuery("#woocommerce_gerencianet_oficial_billet_instructions_line_4").attr("maxlength", "90");
  jQuery("#woocommerce_gerencianet_oficial_pix_cert_name").prop("readonly", true);
});

function showGnTutorial(tutorial) {
  switch(tutorial) {
    case "keysDevelopment": jQuery("#imgTutorial").attr("src", plugin_images_url + "gerencianet-exemplo-chaves-desenvolvimento.png"); break;
    case "keysProduction": jQuery("#imgTutorial").attr("src", plugin_images_url + "gerencianet-exemplo-chaves-producao.png"); break;
    case "payeeCode": jQuery("#imgTutorial").attr("src", plugin_images_url + "gerencianet-exemplo-identificador-conta.png"); break;
  }
  jQuery("#tutorialGnBox").fadeIn();
}

function handleMask(div) {
  jQuery(div).mask("##0,00%", {reverse: true, onKeyPress: (percentage) => {
    if (percentage.length > 6) {
        jQuery(div).val("99,99%");
      }
  }});
}

function onlynumber(evt) {
    var theEvent = evt || window.event;
    var key = theEvent.keyCode || theEvent.which;
    key = String.fromCharCode( key );

    var regex = /^[0-9.]+$/;
    if( !regex.test(key) ) {
       theEvent.returnValue = false;
       if(theEvent.preventDefault) theEvent.preventDefault();
    }
 }
